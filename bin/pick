#!/bin/sh
# -*- coding: utf-8-unix -*-
# vim:fileencoding=utf-8:ff=unix
# @(#) Select arguments.
# Original code is 'The UNIX Programming Environment' Sec.5.7.

set -u
umask 0022
IFS=$(printf ' \t\n_'); IFS=${IFS%_}
PATH=/bin:/usr/bin
export IFS LC_ALL=C LANG=C PATH

readonly progname=${0##*/}
readonly version=3.1.0.20190405

# usage <exit-code>
usage() {
    echo "usage: $progname [-v] [-f footer] [-h header] [args ...]" 1>&2
    exit $1
}

# version (no parameter)
version() {
    echo "$progname $version" 1>&2
    exit 0
}

header=
footer='? [Yes|No|Quit]: '

# do_pick <item>
do_pick() {
    echo -n "$header$1$footer" >/dev/tty
    read response
    case $response in
    [Yy]|[Yy]es|YES)      echo "$i" ;;
    [Qq]|[Qq]uit|QUIT)    break ;;
    esac
}

# main routine

opt=
while getopts 'f:h:v' opt; do
    case $opt in
    f)      footer="$OPTARG" ;;
    h)      header="$OPTARG" ;;
    v)      version ;;
    \?)     usage 1 ;;
    esac
done
shift $(($OPTIND - 1))

if [ $# -eq 1 -a "$1" = '-' ]; then
    # Trims IFS character from the beginning and end of the $i.
    while read i; do
        do_pick "$i" </dev/tty
    done
else
    for i; do
        do_pick "$i"
    done </dev/tty
fi
